<?phpnamespace App\Service\Tax;use Illuminate\Support\Collection;class UserTaxService{    public static function calculateTax(Collection $taxItems, $earning, $method)    {        $deductedEarning = $earning;        $sum = 0;        if ($method == 'old') $taxItems = $taxItems->sortBy('end_subtraction');        elseif ($method == 'new') $taxItems = $taxItems->sortBy('order');        foreach ($taxItems as $item) {            if (!$item->value) continue;            if ($item->is_deduction) { // Vicheti                if ($item->end_subtraction == 0) {                    $deductedEarning -= $item->is_percent ? ( $deductedEarning * $item->value / 100 ) : $item->value;                } else {                    $deductedEarning -= $item->is_percent ? ( ($deductedEarning - $sum) * $item->value / 100 ) : ($item->value + $sum);                }            }            else {                if ($item->end_subtraction == 0) {                    $sum += $item->is_percent ? $deductedEarning * $item->value / 100 : $item->value;                } else {                    $sum += $item->is_percent ? ($deductedEarning * $item->value / 100) : $item->value;                }            }        }        return $sum; // Sum taxes    }}